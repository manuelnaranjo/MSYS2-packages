# Maintainer: Manuel Naranjo <naranjo.manuel@gmail.com>

pkgname="lyx-installer"
pkgver=2.2.1
_pkgrel=2
pkgrel=5
pkgdesc="LyX â€“ The Document Processor (repacked from official installer edition)"
arch=('any')
url="http://www.lyx.org"
license=('GPL2')
makedepends=('p7zip')
depends=('miktex-portable')
options=('!strip')
install="install.sh"
source=(
  ${pkgname}-${pkgver}.exe::"http://downloads.sourceforge.net/project/lyxwininstaller/LyXWinInstaller/${pkgver}/LyX-${pkgver//\./}-Installer-${_pkgrel}.exe"
  "postinstall.py"
)

sha256sums=(
  '1a4f7d94d1d14b5bb04921fc1b7594d518a7bea4a1d16069038e19ed48ee1b1f'
  '649558f9a704bc9191609b5ff57432226aac9b8a34a47e3bb73ad2b74de8b802'
)

prepare() {
  if [ -d "${srcdir}/${pkgname}-${pkgver}" ]; then
    rm -rf "${srcdir}/${pkgname}-${pkgver}"
  fi
  mkdir -p "${srcdir}/${pkgname}-${pkgver}"
  cd "${srcdir}/${pkgname}-${pkgver}"
  7z x "../${pkgname}-${pkgver}.exe"
}

package() {
  mkdir -p "${pkgdir}/usr/bin"
  mkdir -p "${pkgdir}/usr/share/${pkgname}"
  cp -r "${srcdir}/${pkgname}-${pkgver}/bin" "${pkgdir}/usr/share/${pkgname}"
  cp -r "${srcdir}/${pkgname}-${pkgver}/ghostscript" "${pkgdir}/usr/share/${pkgname}"
  cp -r "${srcdir}/${pkgname}-${pkgver}/imagemagick" "${pkgdir}/usr/share/${pkgname}"
  cp -r "${srcdir}/${pkgname}-${pkgver}/Resources" "${pkgdir}/usr/share/${pkgname}"
  cp "${srcdir}/postinstall.py" "${pkgdir}/usr/share/${pkgname}"
}
